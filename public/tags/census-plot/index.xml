<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Census Plot on R &amp; Census</title>
    <link>/tags/census-plot/</link>
    <description>Recent content in Census Plot on R &amp; Census</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Wed, 17 Jan 2018 00:00:00 +0000</lastBuildDate>
    
        <atom:link href="/tags/census-plot/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Plot pie charts of racial composition in largest metro areas on a map in R</title>
      <link>/2018/01/17/create-pie-plots-on-a-map-in-r/</link>
      <pubDate>Wed, 17 Jan 2018 00:00:00 +0000</pubDate>
      
      <guid>/2018/01/17/create-pie-plots-on-a-map-in-r/</guid>
      <description>&lt;p&gt;Pie chart has been criticized for being a poor visualization and is not recommended in R community. The popular &lt;code&gt;ggplot2&lt;/code&gt; package discourages the use of pie charts and there is no dedicated &lt;code&gt;geom_pie&lt;/code&gt; for it.&lt;/p&gt;
&lt;p&gt;Although the criticism is mostly valid, there is a case that pie chart can be useful: pie charts on maps. Pie charting on map is a compact way to show composition by locations.&lt;/p&gt;
&lt;p&gt;A recent &lt;code&gt;R&lt;/code&gt; package, &lt;a href=&#34;https://github.com/GuangchuangYu/scatterpie&#34;&gt;&lt;code&gt;scatterpie&lt;/code&gt;&lt;/a&gt; by Guangchuang Yu, specializes in making pie charts at multiple locations. This package is an extension of &lt;code&gt;ggplot2&lt;/code&gt; so it will be easy for &lt;code&gt;ggplot2&lt;/code&gt; users.&lt;/p&gt;
&lt;p&gt;We will use &lt;code&gt;scatterpie&lt;/code&gt; package to plot the racial composition of largest metropolitan areas in the United state. The demographics data is extracted from 2016 American Community Survey 1-year estimate with &lt;a href=&#34;https://github.com/GL-Li/totalcensus&#34;&gt;&lt;code&gt;totalcensus&lt;/code&gt;&lt;/a&gt; package.&lt;/p&gt;
&lt;p&gt;Letâ€™s first load the required packages.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;library(scatterpie)
library(totalcensus)
library(dplyr)&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now we extract total population and population of selected races in metro areas from 2016 ACS 1-year estimate. We will only keep metro areas with population over one million.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# read all metro data
metro &amp;lt;- read_acs1year(
    year = 2016,
    states = &amp;quot;US&amp;quot;,
    table_contents = c(
        &amp;quot;white = C02003_003&amp;quot;, 
        &amp;quot;black = C02003_004&amp;quot;, 
        &amp;quot;asian = C02003_006&amp;quot;
    ),
    geo_headers = &amp;quot;CBSA&amp;quot;,
    summary_level = &amp;quot;310&amp;quot;
) %&amp;gt;%
    mutate(others = population - white - black - asian)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;## Reading US 2016 ACS 1-year survey geography file&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;# keep only largest metro and make some cleaning
largest &amp;lt;- metro %&amp;gt;%
    filter(population &amp;gt; 1e6) %&amp;gt;%
    # Los Angeles metro changed CBSA from 31100 to 31080, hand correct the coordinate
    # mutate(lon = ifelse(GEOID == &amp;quot;31000US31080&amp;quot;, -118.18194, lon),
    #        lat = ifelse(GEOID == &amp;quot;31000US31080&amp;quot;, 34.10939, lat)) %&amp;gt;%
    select(NAME, lon, lat, total = population, white, black, asian, others) %&amp;gt;%
    arrange(-total)

head(largest, 3)&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;##                                               NAME       lon      lat
## 1 New York-Newark-Jersey City, NY-NJ-PA Metro Area  -73.8745 40.77432
## 2    Los Angeles-Long Beach-Anaheim, CA Metro Area -118.1819 34.10939
## 3    Chicago-Naperville-Elgin, IL-IN-WI Metro Area  -87.8283 41.82352
##      total    white   black   asian  others
## 1 20153634 11704438 3430610 2215765 2802821
## 2 13310447  7080092  880118 2112197 3238040
## 3  9512968  6202988 1577873  617341 1114766&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With the race data, we are ready to make pie plot on a map with package &lt;code&gt;scatterpie&lt;/code&gt;.&lt;/p&gt;
&lt;pre class=&#34;r&#34;&gt;&lt;code&gt;us &amp;lt;- map_data(&amp;#39;state&amp;#39;)
ggplot(us, aes(long, lat)) +
    geom_map(map=us, aes(map_id=region), fill=&amp;quot;grey97&amp;quot;, color=&amp;quot;grey&amp;quot;) +
    geom_scatterpie(data = largest, 
                    aes(lon, lat, r = sqrt(total)/2000),
                    cols = c(&amp;quot;white&amp;quot;, &amp;quot;black&amp;quot;, &amp;quot;asian&amp;quot;, &amp;quot;others&amp;quot;), 
                    alpha = 0.5) +
    scale_fill_manual(
        breaks = c(&amp;quot;white&amp;quot;, &amp;quot;black&amp;quot;, &amp;quot;asian&amp;quot;, &amp;quot;others&amp;quot;),
        labels = c(&amp;quot;white alone&amp;quot;, &amp;quot;black alone&amp;quot;, &amp;quot;asian alone&amp;quot;, &amp;quot;others&amp;quot;),
        values = c(&amp;quot;asian&amp;quot; = &amp;quot;orange&amp;quot;,
                   &amp;quot;white&amp;quot; = &amp;quot;white&amp;quot;,
                   &amp;quot;black&amp;quot; = &amp;quot;black&amp;quot;,
                   &amp;quot;others&amp;quot; = &amp;quot;cyan&amp;quot;)
    ) +
    labs(title = &amp;quot;Races in metro areas over one million population&amp;quot;,
         subtitle = &amp;quot;others includes mixed races and American indians, Alaska natives, native Hawaiians and pacific islanders&amp;quot;,
         caption = &amp;quot;Source: 2016 ACS 1-year estimate&amp;quot;,
         fill = NULL) +
    coord_fixed() +
    theme_bw() +
    theme(legend.position = c(0.96, 0.02),
          legend.justification = c(1, 0),
          panel.grid = element_blank(),
          panel.border = element_blank(),
          axis.title = element_blank(),
          axis.text = element_blank(),
          axis.ticks = element_blank())&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;img src=&#34;../../post/2018-01-16-create-pie-plots-on-a-map-in-r_files/figure-html/unnamed-chunk-4-1.png&#34; width=&#34;672&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>