---
title: A uniform way to use ggplot2
author: GL Li
date: '2017-08-03'
slug: a-uniform-way-to-use-ggplot2
categories:
  - ggplot
tags:
  - plot
---

```{r echo=FALSE}
library(knitr)
opts_chunk$set(message = FALSE, warning = FALSE)
```

Just finished reading Hadley Wickman's ``ggplot2`` book (link to the book). Before that I have been using ``ggplot2`` for a couple of years by mainly learned by reading documentation and searching help online.

My feeling is that ``ggplot2`` is flexible graphing tool. The same plot can be achieved with many different ways. This fexibility provides obvious convenience but also introduces a lot of confusion (how to express this meaning?) and extra burden of memorization. 

After reading this book, I learned that there are even more ways to do the same job and I am not happy with it. I am a lazy user and do not want to memorize all these different methods. What I want is an appoach that get the job done, that is easy to apply to many tasks, and does not have much to memorize. I need a uniform way to use `ggplot2`.

Here I discuss how I like to organize `ggplot2` plotting. It is my personal preference. Every one can find their best way, but I will give the reason why I am doing this way.

### What to be included in ``ggplot()``?
Every `ggplot2` plotting starts with the function ``ggplot()``. Typically `data` and `aes()` are included as arguments. The `aes()` can include `x`, `y` and more aesthetic mapping such as `color`, `shape`, `fill`, ..., as in the code below,

```{r eval=FALSE}
ggplot(data = mpg, aes(x = displ, y = cty, color = drv, shape = year, fill = cyl))
# or to simplify
ggplot((mpg, aes(displ, cty, color = drv, shape = year, fill = cyl)))
```

My preference for this part is to include as fewer arguments as possible, even without any argument. All these arguments are inherited by all plotting layers by default. If you want them to be used in these layers, then that is good; you save a few keystroke. But if it is not what you want, it is where trouble hides. For example, if your want to a linear fit to all data points but has `color` in aesthetic mapping, the fit is applied to each color. You'd better move the `color` of `ggplot()`. 

```{r fig.height=3, fig.width=5}
library(ggplot2)
ggplot(mpg, aes(cty, hwy, color = drv)) +
    geom_point() +
    stat_smooth(method = "lm")
```


### `geom_xxx()` or `stat_xxx()`?
This is one of the reasons for flexibility and confusion; some `geom`s have equivalent `stats`, such as `geom_smooth()` and `stat_smooth()`, `geom_bar()` and `stat_count`, and `geom_boxplot()` and `stat_boxplot()`. Even `geom_point()` has an equivalent `stat_identity()`. So which one to use? 

I like to use `geom_xxx()` for layers that directly plot the original data and `stat_xxx()` for layers that plot statistical transformation of the original data. The former includes `geom_point()`, `geom_line()`, and `geom_col()`. The latter includes `stat_smooth()`, `stat_count`, and `stat_boxplot()`. This a naturla choice to me as I pay more attention to data; whenever statistical transformed data are used, I want to use it explicitly. Using `stat_xxx()` has additional benefit: we can choose the right `geom` as desired. In the following code, the counts of `drv` are displayed as bar, point and line.

```{r fig.height=3, fig.width=4}
ggplot(mpg, aes(drv)) +
    stat_count(geom = "bar", fill = "grey70") +
    stat_count(geom = "point", size = 6, color = "blue") +
    stat_count(geom = "line", aes(group = 1), color = "red")
```

A few words about bar plot. Above count of one categorical variable are often plotted with `geom_bar()`. The awkward thing is that `geom_bar(stat = "identity")` also make bar plot when two variables `aes(x, y)` are provided. To solve this issue, `ggplot2` version 2.2.0 introduced `geom_col(aes(x, y))` to take care bar plot from two variables. 


### axis and legend
Almost all components regarding axis and legend can be specified in `scale_xxx_xxx()` funtions. You will get the job done by only using them. The code may be too busy though. Several help functions do part of `scale_xxx_xxx()`'s job and make the code succint, such as `xlab()` and `ylim()`. 

I like two help functions: `labs()` sets titles of all axis and lengends and `guides()` arranges multiple legends. Together with `scale_xxx_xxx()`, the three take care axis and legend in a logical way:

- `scale_xxx_xxx()` determines what to show. They are used to set breaks and labels of each aesthetics, which are the real data to show.
- `guides()` determines how to display. It is a best practice arrange each legend by considering all of them the same. 
- `labs()` determines how to call them. It names axis and legend in one place by treating all axis and legend as a whole, which helps to name them in the same style. 

```{r}
ggplot(mpg, aes(hwy, cty, color = factor(cyl), shape = drv)) +
    geom_point(aes(size = displ)) +
    # what to display
    scale_x_continuous(limits = c(0, 50),
                       breaks = c(0, 20, 40),
                       labels = c("zero", "twenty", "fourty"), 
                       minor_breaks = c(5, 10, 15)) +
    scale_y_continuous(labels = NULL) +   # remove labels with NULL
    scale_color_discrete(breaks = c(4, 5, 6, 8), 
                         labels = c("four", "five", "six", "eight")) + # asign colors by default
                                    
    scale_shape_manual(limits = c("f", "r"),      # manually select shape
                       values = c(f = 0, r = 2)) +
    # how to display
    guides(
        size = "none",  # hide size
        color = guide_legend(direction = "horizontal",
                             title.position = "top",
                             nrow = 2,
                             byrow = TRUE,  # arrange row by row, default is by column
                             order = 1),    # first legend to show
        shape = guide_legend(direction = "vertical",
                             reverse = TRUE)  # reverse order of legend keys
    ) +
    # what's your name
    labs(title = "Use labs(), scale_xxx(), guides() for legend and axis",
         subtitle = "scale_xxx for what to display, guides for how to display, labs for titles",
         x = "highway mileage",
         y = "city mileage", 
         color = "cylinder", 
         shape = "drive train", 
         size = "haha you cannot see me") 

```

